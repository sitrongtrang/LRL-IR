<?xml version="1.0" encoding="UTF-8"?>

<text>
 <s id="1">Ethic and Hedge are on the ground floor of a massive tower.</s>
 <s id="2">Barriers of energy separate them from their quest’s second goal: the Node of Creation.</s>
 <s id="3">To reach it, Ethic must use three energy streams to climb the tower.</s>
 <s id="4">As soon as she steps forward a timer will begin counting down from 60 seconds.</s>
 <s id="5">At the back of the room there’s a basin made of invisible towers that can hold energy between them.</s>
 <s id="6">After one minute, a torrent of energy will pour down from above, filling one unit at a time, with a force field preventing it from spilling out the front or back.</s>
 <s id="7">During the 60 calm seconds, Ethic and Hedge must decide exactly how many units of energy will fall.</s>
 <s id="8">For each of the three challenges, they must choose the amount that will fill the basin exactly.</s>
 <s id="9">If they do so, the energy will propel them further upwards.</s>
 <s id="10">But if they get the amount at all wrong, the energy lift will fail, dropping them.</s>
 <s id="11">Diagrams on the walls illustrate some examples.</s>
 <s id="12">This configuration will capture exactly 2 units of energy.</s>
 <s id="13">This configuration will capture 4— 3 here, and 1 here.</s>
 <s id="14">And this one will also capture 4, because any energy on the right would spill out.</s>
 <s id="15">The energy will rain down in such a way that it’ll only overflow if there’s no space that could hold it.</s>
 <s id="16">Hedge can make one tower of blocks visible at a time and count how tall it is, but he can’t look at the whole structure all at once.</s>
 <s id="17">How does Ethic program Hedge to figure out exactly how much energy each basin can hold?</s>
 <s id="18">Pause now to figure it out for yourself.</s>
 <s id="19">Here’s one way of thinking about what’s happening: each unoccupied cell will hold energy if and only if there is a wall eventually to its left, and a wall eventually to its right.</s>
 <s id="20">But it would take a long time for Hedge to check this for each individual cell.</s>
 <s id="21">So what if he were to consider a whole column of blocks at a time?</s>
 <s id="22">How many units of energy can this hold, for instance?</s>
 <s id="23">Pause now to figure it out for yourself.</s>
 <s id="24">Let’s analyze the problem by looking at our example.</s>
 <s id="25">There are 5 columns of blocks here.</s>
 <s id="26">The leftmost one can’t hold any energy, because there’s nothing higher than it.</s>
 <s id="27">The 2nd stack can have 3 units above it, as they would be trapped between these two 4 block stacks.</s>
 <s id="28">We get 3 units by taking the height where the energy would level off— 4, and subtracting the height of the stack— so that’s 4 minus 1.</s>
 <s id="29">The 3rd stack is similar— 4 to the left, 4 to the right, and it’s 3 high, so it’ll hold 4 minus 3 equals 1 unit.</s>
 <s id="30">The 4th stack and 5th stacks have nothing higher than them to the right, so they can’t hold any energy.</s>
 <s id="31">We can adapt this idea into an algorithm.</s>
 <s id="32">Considering one column at a time as the point of reference, Hedge can look to the left stack by stack to find the height of the tallest one, look to the right to find the height of the tallest one, and take the smaller of the two as the height the energy can fill up to.</s>
 <s id="33">If the result is higher than the column in question, subtract the height of the original column, and the result will be the number of units that column can hold.</s>
 <s id="34">If it's equal to or below the level of the column in question, the energy would spill off.</s>
 <s id="35">Hedge can apply that to an entire basin with a loop that starts on the left-most column and moves right, one column at a time.</s>
 <s id="36">For each column, he’ll run the same steps— look all the way left for the tallest, do the same to the right, take the lower height of the two, subtract the original column height, and increase the grand total if that number is positive.</s>
 <s id="37">His loop will repeat as many times as there are columns.</s>
 <s id="38">That will work, but it’ll take a long time for a large basin.</s>
 <s id="39">At every step Hedge repeats the action of looking left and looking right.</s>
 <s id="40">If there are N stacks, he’ll look at all N stacks N times.</s>
 <s id="41">Is there a faster way?</s>
 <s id="42">Here’s one time saver: before doing anything else, Hedge can start on the left, and keep a running tally of what the highest stack is.</s>
 <s id="43">Here that would be 2, 2 again, since the first was higher, then 4, 4, 4.</s>
 <s id="44">He can then find the highest right-most stacks by doing the same going right-to-left: 1, 3, 4, 4, 4.</s>
 <s id="45">In the end he’ll have a table like this in his memory.</s>
 <s id="46">Now, Hedge can take one more pass to calculate how much energy there will be above every stack with the same equation from before: take the smaller of the stored left and right values, and subtract the height of the current tower.</s>
 <s id="47">Instead of looking at N stacks N times, he’ll look at N stacks just 3 times— which is what’s called linear time.</s>
 <s id="48">There are ways to optimize the solution even further, but this is good enough for our heroes.</s>
 <s id="49">Ethic and Hedge work as one.</s>
 <s id="50">The first cascade is a breeze, and they rise up the tower.</s>
 <s id="51">The second is a little tougher.</s>
 <s id="52">The third is huge, with dozens of stacks of blocks.</s>
 <s id="53">The timer ticks down towards zero, but Ethic’s program is fast.</s>
 <s id="54">She gets the wheel in position just in time, and the energy lifts them to the Node of Creation.</s>
 <s id="55">Like the first, it reveals a vision: memories of years gone by.</s>
 <s id="56">The world machine changed everything, and Ethic, in her position as chief robotics engineer, grew troubled by what she saw.</s>
 <s id="57">When the Bradbarrier went up to keep the people in, she knew something was seriously wrong.</s>
 <s id="58">So she created three artifacts with the ability to restore people’s power, creativity, and memory, and smuggled them to three communities.</s>
 <s id="59">Before she could tell people how to use them, the government discovered her efforts and sent bots to arrest her and the other programmers.</s>
 <s id="60">The last thing Ethic used the world machine to create was a robot that would protect the ancient device from the forces of ignorance by enclosing it in a giant maze.</s>
 <s id="61">She named her creation Hedge.</s>
 <s id="62">Without warning, the energy lift flickers, then fizzles out.</s>
</text>
